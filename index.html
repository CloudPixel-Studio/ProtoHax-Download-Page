<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="screen-orientation" content="portrait" />
    <meta name="format-detection" content="telephone=no">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <title>ProtoHax Download</title>
    <link rel="stylesheet" href="./css/base.css?v=1.03" />
    <link rel="stylesheet" href="./css/style2.css" />
</head>

<body>
   <div class="app style2 theme1">
        <div id="eLogo" class="logo"></div>
        <div class="container">
            <div class="version">
                <div id="commitText">Loading...</div>
                <div id="timeText">Loading...</div>
                <div id="branch">Stable</div>
            </div>
            <div class="btn-group">
                <a id="eIphone" href="" class="btn ios flex ">
                    <span>Download</span>
                </a>
                <a id="eAndroid" href="" class="btn android flex">
                    <svg t="1622038313232" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="1204" width="26" height="26">
                        <path
                            d="M287.01171846 737.01171846c0 20.62392627 16.87412109 37.49804737 37.49804736 37.49804736l37.49804736 0 0 131.24316446c0 31.12337901 25.12369161 56.2470706 56.2470706 56.2470706s56.2470706-25.12369161 56.24707062-56.2470706l0-131.24316445 74.99609385-1e-8 0 131.24316446c0 31.12337901 25.12369161 56.2470706 56.2470706 56.2470706s56.2470706-25.12369161 56.2470706-56.2470706l0-131.24316445 37.49804737-1e-8c20.62392627 0 37.49804737-16.87412109 37.49804736-37.49804736l0-374.98047012-449.97656397 0 0 374.98047012zM193.26660049 362.03124834c-31.12337901 0-56.2470706 25.12369161-56.24707061 56.24707061l0 262.48632891c0 31.12337901 25.12369161 56.2470706 56.24707061 56.2470706s56.2470706-25.12369161 56.2470706-56.2470706l0-262.48632891c0-31.12337901-25.12369161-56.2470706-56.2470706-56.24707061zM830.73339951 362.03124834c-31.12337901 0-56.2470706 25.12369161-56.2470706 56.24707061l0 262.48632891c0 31.12337901 25.12369161 56.2470706 56.2470706 56.2470706s56.2470706-25.12369161 56.24707061-56.2470706l0-262.48632891c0-31.12337901-25.12369161-56.2470706-56.24707061-56.24707061zM644.36810557 143.0426542l48.93495117-48.93495118c7.31211943-7.31211943 7.31211943-19.1240042 0-26.43612275s-19.1240042-7.31211943-26.43612276 0l-55.49710956 55.30961953c-29.99843789-14.81172891-63.55919004-23.4362795-99.36982442-23.43627949-35.99812529 0-69.74636748 8.62455058-99.93229541 23.62376953l-55.68459961-55.68459961c-7.31211943-7.31211943-19.1240042-7.31211943-26.43612275 0s-7.31211943 19.1240042 0 26.43612276l49.12244121 49.12244121c-55.68459961 41.06036162-92.05770498 107.05692393-92.05770498 181.49054765l449.97656396 0c0-74.62111377-36.56059541-140.61767607-92.62017597-181.49054765zM437.00390615 249.53710713l-37.49804737 0 0-37.49804736 37.49804737 0 0 37.49804736zM624.49414122 249.53710713l-37.49804737 0 0-37.49804736 37.49804737 0 0 37.49804736z"
                            fill="#ffffff" p-id="1205"></path>
                    </svg>
                    <span>Download</span></a>
            </div>
            <div class="copyright">CloudPixel Branch</div>

        </div>
    </div>

  <script type="text/javascript">
    var $ = function (ele) {
        return document.querySelector(ele);
    }
    // 配置
    var config = {
        cover: '', // 封面图片默认：。./imgs/cover4.jpg,替换cover4.jpg即可
        iPhone_download_name: "立即下载", // iPhone下载名称
        android_download_name: "立即下载", // Android下载名称
        iPhone_download_url: "", // iPhone下载链接
        android_download_url: "", // Android下载链接
        open_app_url: ""
    }
    var env = function () {
        var inBrowser = typeof window !== 'undefined'
        var UA = inBrowser && window.navigator.userAgent.toLowerCase();
        return {
            isAndroid: UA && UA.indexOf('android') > 0,
            isIOS: UA && /iphone|ipad|ipod|ios/.test(UA),
            isWechat: UA && UA.indexOf('micromessenger') > -1
        }
    }

window.onload = async function() {
  var iphone = document.getElementById('eIphone');
  var android = document.getElementById('eAndroid');
  var cover = document.getElementById('eLogo');

  try {
    if (env().isAndroid) {
      iphone.style.display = "none";
      android.style.display = "flex";
    } else {
      iphone.style.display = "flex";
      android.style.display = "none";
    }

    // 设置封面
    cover.style.backgroundImage = 'url(./imgs/logo@2x.png)';

    // iPhone 下载链接设置
    config.iPhone_download_url = 'https://nightly.link/CloudPixel-Studio/ProtoHax-Android/workflows/android/stable/ProtoHax-Android.zip';
    iphone.href = config.iPhone_download_url;

    // iPhone 下载链接名称设置
    iphone.querySelector('span').innerText = config.iPhone_download_name;

    // Android 下载链接设置
    config.android_download_url = 'https://nightly.link/CloudPixel-Studio/ProtoHax-Android/workflows/android/stable/ProtoHax-Android.zip';
    android.href = config.android_download_url;

    // Android 下载链接名称设置
    android.querySelector('span').innerText = config.android_download_name;
  } catch (error) {
    console.error(error);
    // 处理获取最新构建下载链接失败的情况
  }
};
</script>
<script>
        // 获取最后构建的版本号和日期
        async function getLastBuildInfo() {
            const response = await fetch('https://api.github.com/repos/CloudPixel-Studio/ProtoHax-Android/actions/runs?event=push&status=success&branch=stable', {
                headers: { 'Accept': 'application/vnd.github.v3+json' }
            });
            const data = await response.json();
            if (response.ok && data.workflow_runs.length > 0) {
                const lastBuild = data.workflow_runs[0];
                const commitText = document.getElementById('commitText');
                const timeText = document.getElementById('timeText');
                const buildDate = new Date(lastBuild.created_at).toLocaleDateString();
                commitText.textContent = lastBuild.head_commit.message;
                timeText.textContent = 'Commit Time : ' + buildDate;
              } else {
                throw new Error('Failed to fetch last build info');
            }
        }

        // 在页面加载完成后执行操作
        window.addEventListener('load', async () => {
            try {
                await getLastBuildInfo();
            } catch (error) {
                console.error(error);
                // 处理获取最后构建信息失败的情况
            }
        });
    </script>
</body>

</html>
